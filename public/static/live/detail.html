<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>郭毅小天使图片直播 - 详情</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<meta content="yes" name="apple-mobile-web-app-capable" />
	<meta content="black" name="apple-mobile-web-app-status-bar-style" />
	<meta content="telephone=no" name="format-detection" />
	<meta content="email=no" name="format-detection" />
	<link rel="stylesheet" type="text/css" href="./assert/css/reset.css" />
	<link rel="stylesheet" type="text/css" href="./assert/css/main.css" />
	<link rel="stylesheet" type="text/css" href="./css/detail.css" />
	<link rel="stylesheet" href="./assert/iconfont/iconfont.css">
	<link rel="shortcut icon" href="./favicon.ico">
	<script src="./js/jquery-3.3.1.min.js"></script>
	<script src="./js/live.js"></script>
	<script src="./js/chat.js" type="module"></script>
	<script src="./js/user_chat_push.js" type="module"></script>
	<script src="./js/jquery.cookie.js"></script>
	<!--播放插件-->
	<link href="./videolib/css/video-js.min.css" rel="stylesheet" type="text/css">
	<script src="./videolib/js/video.min.js"></script>
	<!-- 引入的videojs-flash.js插件主要是为播放rtmp视频流-->
	<script src="./videolib/videojs-flash.min.js"></script>
</head>

<body>
	<header class="header xxl-font">
		<i id="title" class="icon iconfont icon-fanhui back" id="back"></i>
		<div id='html_titile'></div>
		<!--用户处于登录状态时，将该按钮隐藏-->
		<!-- <a href="./login.html"> -->
		<span id="perfect">
			<i class="icon iconfont icon-wode my"></i>
		</span>
	</header>
	<div class="content">
		<div class="poster">
			<!--<img src="./imgs/match-poster.png" class="post-img" />-->
			<!--<img id="banner" class="post-img" />-->
			<video id='myvideo' muted autoplay='autoplay' preload='auto'  data-setup="{}" style="width:100%;height:30vh;object-fit:fill" class="video-js vjs-default-skin" controls>
				<!-- RTMP直播源地址-->
				<source src="rtmp://liveplay.qvbilam.xin/lol/1234">
			</video>
			<!-- <div class="poster-title">
				<div class="poster-title-team">
					<img src="./imgs/team1.png" width="40px" height="40px">
					<img id="a_image" width="40px" height="40px">
					<div id="a_name"></div>
				</div>
				<div>VS</div>
				<div class="poster-title-team">
					<img src="./imgs/team2.png" width="40px" height="40px">
					<img id="b_image" width="40px" height="40px">
					<div id="b_name"></div>
				</div>
			</div> -->
		</div>
		<div class="tab-nav">
			<div class="active">赛况</div>
			<div>聊天室</div>
			<!--<div>数据</div>-->
		</div>
		<div class="tab-block" id="tab-block">
			<div id="match-result">
			</div>
			<div id="comments" class="hidden comments">
				<div class="comment">
					<span></span>
					<span>欢迎来到直播间</span>
					<div id="menu">
						<span id="username"></span>
						<span class="menu">去TA的个人空间</span>
						<span class="menu">屏蔽发送者</span>
						<span class="menu">举报选中弹幕</span>
					</div>
				</div>
				<div class="comment-form">
					<input id="chatPush" type="text" placeholder="别憋着，说点啥~~ 回车既发射"></input>
				</div>
			</div>
			<!--<div id="match-data" class="hidden match-data">-->
			<!--<div class="match-score">-->
			<!--<div class="match-team-info">-->
			<!--<img src="./imgs/team1.png" width="40px" height="40px"/>-->
			<!--<div>火箭</div>-->
			<!--</div>-->
			<!--<div class="match-score-result">-->
			<!--<div style="font-size: .8rem;color: red;">第一小节 01：40</div>-->
			<!--<div style="font-size: 1.2rem; color:red;">-->
			<!--<span>21</span>-->
			<!--<span>Live</span>-->
			<!--<span>22</span>-->
			<!--</div>-->
			<!--<div style="font-size: .8rem; color:#888;">NBA常规赛</div>-->
			<!--</div>-->
			<!--<div class="match-team-info">-->
			<!--<img src="./imgs/team2.png" width="40px" height="40px"/>-->
			<!--<div>雷霆</div>-->
			<!--</div>-->
			<!--</div>-->
			<!--<div class="match-report">-->
			<!--<h3 class="sub-title">赛况</h3>-->
			<!--<div class="match-report-row row-title">-->
			<!--<span>球队</span>-->
			<!--<span>1TH</span>-->
			<!--<span>2TH</span>-->
			<!--<span>3TH</span>-->
			<!--<span>4TH</span>-->
			<!--<span>总分</span>-->
			<!--</div>-->
			<!--<div class="match-report-row">-->
			<!--<span><img src="./imgs/team1.png" width="30px" height="30px"/></span>-->
			<!--<span>20</span>-->
			<!--<span>-</span>-->
			<!--<span>-</span>-->
			<!--<span>20</span>-->
			<!--<span>40</span>-->
			<!--</div>-->
			<!--<div class="match-report-row">-->
			<!--<span>-->
			<!--<img src="./imgs/team2.png" width="30px" height="30px"/>-->
			<!--</span>-->
			<!--<span>15</span>-->
			<!--<span>-</span>-->
			<!--<span>-</span>-->
			<!--<span>30</span>-->
			<!--<span>40</span>-->
			<!--</div>-->
			<!--</div>-->
			<!--<div class="mvp">-->
			<!--<h3 class="sub-title">本场最佳</h3>-->
			<!--<div>-->
			<!--<div class="mvp-player">-->
			<!--<img src="./imgs/pa.png" width="50px;" height="40px"/>-->
			<!--<div class="mvp-player-info">-->
			<!--<div>9</div>-->
			<!--<div>帕克</div>-->
			<!--</div>-->
			<!--</div>-->
			<!--<div class="mvp-score">-->
			<!--<span>10</span>-->
			<!--<span class="mvp-score-label">得分</span>-->
			<!--<span>12</span>-->
			<!--</div>-->
			<!--<div class="mvp-player">-->
			<!--<div class="mvp-player-info">-->
			<!--<div>13</div>-->
			<!--<div>哈登</div>-->
			<!--</div>-->
			<!--<img src="./imgs/ha.png" width="50px;" height="40px"/>-->
			<!--</div>-->
			<!--</div>-->
			<!--<div>-->
			<!--<div class="mvp-player">-->
			<!--<img src="./imgs/pa.png" width="50px;" height="40px"/>-->
			<!--<div class="mvp-player-info">-->
			<!--<div>9</div>-->
			<!--<div>帕克</div>-->
			<!--</div>-->
			<!--</div>-->
			<!--<div class="mvp-score"><span>10</span><span class="mvp-score-label">助攻</span><span>9</span></div>-->
			<!--<div class="mvp-player">-->
			<!--<div class="mvp-player-info">-->
			<!--<div>3</div>-->
			<!--<div>保罗</div>-->
			<!--</div>-->
			<!--<img src="./imgs/bao.png" width="50px;" height="40px"/>-->
			<!--</div>-->
			<!--</div>-->
			<!--</div>-->
			<!--</div>-->
		</div>
	</div>

	<script>
		var player = videojs('myvideo', {}, function () { console.log('videojs播放器初始化成功') })
		player.play();
		function killErrors() {
				return true;
			}
			window.onerror = null;
			window.onerror = killErrors
	</script>
	<script type="module">
		import { game } from './../servers/api.js'
		$(function () {
			var $nav = $('.tab-nav div');
			var $content = $('.tab-block > div');
			var $back = $('#title');

			var $perfect = $('#perfect')
			$perfect.click(function () {
				var token = localStorage.getItem('token')
				if (token) {
					$.ajax({
						type: "GET",
						contentType: "application/json;charset=UTF-8",
						url: agreement + '//' + host + '/index/token/checkToken',
						data: null,
						beforeSend: function (XMLHttpRequest) {
							XMLHttpRequest.setRequestHeader("AUTHORIZATION", token);
						},
						success: function (result) {
							window.location.href = agreement + '//' + host + '/live/perfect.html'
						},
						error: function (err) {
							alert('用户未登录')
							window.location.href = agreement + '//' + host + '/live/login.html'
						}
					});
				} else {
					alert("用户未登录")
					window.location.href = agreement + '//' + host + '/live/login.html'
				}
			})
			/*切换tab*/
			$nav.click(function () {
				var $this = $(this);
				var $t = $this.index();
				$nav.removeClass();
				$this.addClass('active');
				$content.css('display', 'none');
				$content.eq($t).css('display', 'block');
				setTimeout(() => {
					let comments = document.getElementById('comments')
					comments.scrollTop = comments.scrollHeight
				}, 1)
				// setTimeout(function(){
				// 		let matchResult = document.getElementById('match-result')
				// 		matchResult.scrollTop = matchResult.scrollHeight
				// },100)
			});

			$back.click(function () {
				window.history.back();
			});
		});

		/*获取数据*/
		var host = window.location.host;
		var agreement = window.location.protocol;
		var getData = window.location.search
		var index = getData.substr(1).lastIndexOf("=");
		var game_id = getData.substring(index + 1, getData.length);
		var data = 'game_id=' + game_id.substr(1)
		game(data, function (data) {
			/*追加首页信息*/
			console.log(data.data.game)
			// $('#banner').attr('src', data.data.game[0].banner_image)
			$('#a_image').attr('src', data.data.game[0].a_image)
			$('#b_image').attr('src', data.data.game[0].b_image)
			$('#html_titile').append("<font color='red'>" + data.data.game[0].a_name + '</font> vs <font color="red">' + data.data.game[0].b_name + '</font> 赛况')
			$('#a_name').append(data.data.game[0].a_name)
			$('#a_name').append('(战斗力:' + data.data.game[0].a_score + ')')
			$('#b_name').append(data.data.game[0].b_name)
			$('#b_name').append('(战斗力:' + data.data.game[0].b_score + ')')

			/*追加赛况*/
			if (data.data.live.length > 0) {
				for (var i = 1; i < data.data.live.length + 1; i++) {
					var class_html = '<div class="frame" id="number_' + i + '">'
					class_html += '<h3 class="frame-header">'
					class_html += '<i class="icon iconfont icon-shijian"></i>第 ' + i + ' 节'
					class_html += '</h3>'
					class_html += '<span class="frame-dot"></span>'
					class_html += '</div>'
					$('#match-result').prepend(class_html);
				}

				for (var i = 0; i < data.data.live.length; i++) {
					for (var j = 0; j < data.data.live[i].length; j++) {
						var content_html = '<div class="frame-item">'
						content_html += '<span class="frame-dot"></span>'
						content_html += '<div class="frame-item-author">'
						if (data.data.live[i][j].uimage != null) {
							content_html += '<img src="' + data.data.live[i][j].uimage + '" width="20px" height="20px"/>'
						}

						if (data.data.live[i][j].uname != null) {
							content_html += data.data.live[i][j].uname
						} else {
							content_html += '解说员：'
						}
						content_html += '</div>'
						content_html += '<p>' + data.data.live[i][j].content + '</p>'
						if (data.data.live[i][j].image != null) {
							content_html += '<image width="200px" src="' + data.data.live[i][j].image + '"/>'
						}
						content_html += '</div>'
						$('#number_' + data.data.live[i][j].type).append(content_html)
					}
				}
				let matchResult = document.getElementById('match-result')
				matchResult.scrollTop = matchResult.scrollHeight

				/*卧槽nm啊！ 真有人能看到这 能体会到老子拼数据的痛苦吗*/
				// for (i = 1; i < data.data.live.length; i++) {
				//     for (j = 0; j < data.data.live[i].length; j++) {
				//         if (j == 0 || (data.data.live[i][j].uuid != data.data.live[i][j - 1].uuid)) {
				//             data_html = '<div class="frame-item">'
				//             data_html += '<div class="frame-item-author">'
				//             data_html += '<img src="'+data.data.live[i][j].uimage+'" width="20px" height="20px" />'+data.data.live[i][j].uname
				//             data_html += '</div>'
				//             data_html += '</div>'
				//         } else {
				//             data_html = '<p>' + data.data.live[i][j].content + '</p>'
				//         }
				//         $('#number_' + i).append(data_html)
				//     }
				// }
			}

			/*追加聊天室*/
			// console.log(data,'########33')
			// for (var k = 0; k < data.data.chat.length; k++) {
			// 	var html = '<div class="comment">'
			// 	html += '<span>' + data.data.chat[k].uname + '：</span>'
			// 	html += '<span>' + data.data.chat[k].content + '</span>'
			// 	html += '</div>'
			// 	$('#comments').append(html)
			// }
		
		})

	</script>
</body>

</html>